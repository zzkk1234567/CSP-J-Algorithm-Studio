<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯• AlgorithmVisualizer é‡æ„</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸ§ª AlgorithmVisualizer é‡æ„æµ‹è¯•</h1>
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4">æµ‹è¯•é¡¹ç›®</h2>
            <div id="test-results" class="space-y-2"></div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4">äº‹ä»¶æ—¥å¿—</h2>
            <div id="event-log" class="bg-gray-800 text-green-400 p-4 rounded font-mono text-sm h-64 overflow-y-auto"></div>
        </div>
        
        <div id="visualizer-container"></div>
    </div>

    <script src="algorithm-visualizer.js"></script>
    <script>
        const testResults = document.getElementById('test-results');
        const eventLog = document.getElementById('event-log');
        
        function logEvent(message) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.innerHTML += `[${timestamp}] ${message}\n`;
            eventLog.scrollTop = eventLog.scrollHeight;
        }
        
        function addTestResult(name, passed, message = '') {
            const div = document.createElement('div');
            div.className = `p-3 rounded ${passed ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`;
            div.innerHTML = `
                <span class="font-bold">${passed ? 'âœ…' : 'âŒ'} ${name}</span>
                ${message ? `<br><span class="text-sm">${message}</span>` : ''}
            `;
            testResults.appendChild(div);
        }
        
        // æµ‹è¯• 1: åŸºæœ¬å®ä¾‹åŒ–
        try {
            const viz = new SortingVisualizer('visualizer-container', 'bubble');
            addTestResult('åŸºæœ¬å®ä¾‹åŒ–', true, 'æˆåŠŸåˆ›å»º SortingVisualizer å®ä¾‹');
            
            // æµ‹è¯• 2: _mergeOptions æ–¹æ³•
            const hasOptions = viz.options && viz.options.speed && viz.options.colors;
            addTestResult('_mergeOptions æ–¹æ³•', hasOptions, `é€‰é¡¹å·²æ­£ç¡®åˆå¹¶ï¼Œé€Ÿåº¦: ${viz.options.speed}ms`);
            
            // æµ‹è¯• 3: _initializeState æ–¹æ³•
            const hasState = viz.state && typeof viz.state.isPlaying === 'boolean';
            addTestResult('_initializeState æ–¹æ³•', hasState, 'çŠ¶æ€å¯¹è±¡å·²æ­£ç¡®åˆå§‹åŒ–');
            
            // æµ‹è¯• 4: äº‹ä»¶ç³»ç»Ÿ - on æ–¹æ³•
            let eventFired = false;
            viz.on('test-event', (data) => {
                eventFired = true;
                logEvent(`è‡ªå®šä¹‰äº‹ä»¶è§¦å‘: ${JSON.stringify(data)}`);
            });
            viz.emit('test-event', { test: 'data' });
            addTestResult('äº‹ä»¶ç³»ç»Ÿ - on/emit', eventFired, 'äº‹ä»¶ç›‘å¬å’Œè§¦å‘æ­£å¸¸å·¥ä½œ');
            
            // æµ‹è¯• 5: ç›‘å¬å†…ç½®äº‹ä»¶
            viz.on('play', (data) => logEvent(`â–¶ï¸ æ’­æ”¾äº‹ä»¶: ${JSON.stringify(data)}`));
            viz.on('pause', (data) => logEvent(`â¸ï¸ æš‚åœäº‹ä»¶: ${JSON.stringify(data)}`));
            viz.on('reset', (data) => logEvent(`ğŸ”„ é‡ç½®äº‹ä»¶: ${JSON.stringify(data)}`));
            viz.on('step', (data) => logEvent(`ğŸ‘£ æ­¥éª¤äº‹ä»¶: æ­¥éª¤ ${data.currentStep}`));
            viz.on('compare', (data) => logEvent(`ğŸ” æ¯”è¾ƒäº‹ä»¶: ç´¢å¼• [${data.indices}]`));
            viz.on('swap', (data) => logEvent(`ğŸ”„ äº¤æ¢äº‹ä»¶: ${data.index1} â†” ${data.index2}`));
            viz.on('complete', (data) => logEvent(`âœ… å®Œæˆäº‹ä»¶: ${data.comparisons} æ¬¡æ¯”è¾ƒ, ${data.swaps} æ¬¡äº¤æ¢, è€—æ—¶ ${data.duration}ms`));
            viz.on('destroyed', (data) => logEvent(`ğŸ’¥ é”€æ¯äº‹ä»¶: ${JSON.stringify(data)}`));
            
            addTestResult('å†…ç½®äº‹ä»¶ç›‘å¬å™¨', true, 'å·²æ³¨å†Œæ‰€æœ‰å†…ç½®äº‹ä»¶ç›‘å¬å™¨');
            
            // æµ‹è¯• 6: destroy æ–¹æ³•å­˜åœ¨
            const hasDestroy = typeof viz.destroy === 'function';
            addTestResult('destroy æ–¹æ³•', hasDestroy, 'destroy æ–¹æ³•å·²å®ç°');
            
            // æµ‹è¯• 7: èµ„æºç®¡ç†å±æ€§
            const hasResourceManagement = Array.isArray(viz.timers) && Array.isArray(viz.eventListeners);
            addTestResult('èµ„æºç®¡ç†', hasResourceManagement, 'å®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨æ•°ç»„å·²åˆå§‹åŒ–');
            
            // æµ‹è¯• 8: åˆå§‹åŒ–å¯è§†åŒ–
            viz.setData([5, 3, 8, 2, 7, 1, 9, 4, 6]);
            viz.init();
            const containerHasContent = viz.container.innerHTML.length > 0;
            addTestResult('åˆå§‹åŒ–å¯è§†åŒ–', containerHasContent, 'å¯è§†åŒ–ç•Œé¢å·²æ¸²æŸ“');
            
            // æµ‹è¯• 9: æ’­æ”¾å’Œæš‚åœ
            setTimeout(() => {
                viz.play();
                setTimeout(() => {
                    viz.pause();
                    addTestResult('æ’­æ”¾å’Œæš‚åœ', true, 'æ’­æ”¾å’Œæš‚åœåŠŸèƒ½æ­£å¸¸');
                }, 500);
            }, 500);
            
            // æµ‹è¯• 10: é‡ç½®åŠŸèƒ½
            setTimeout(() => {
                viz.reset();
                addTestResult('é‡ç½®åŠŸèƒ½', true, 'é‡ç½®åŠŸèƒ½æ­£å¸¸');
            }, 1500);
            
            // æµ‹è¯• 11: destroy æ¸…ç†
            setTimeout(() => {
                const timersBefore = viz.timers.length;
                const handlersBefore = Object.keys(viz.eventHandlers).length;
                
                viz.destroy();
                
                const timersAfter = viz.timers.length;
                const handlersAfter = Object.keys(viz.eventHandlers).length;
                const containerEmpty = viz.container.innerHTML === '';
                
                const cleaned = timersAfter === 0 && handlersAfter === 0 && containerEmpty;
                addTestResult('destroy æ¸…ç†', cleaned, 
                    `å®šæ—¶å™¨: ${timersBefore}â†’${timersAfter}, äº‹ä»¶å¤„ç†å™¨: ${handlersBefore}â†’${handlersAfter}, DOMå·²æ¸…ç©º: ${containerEmpty}`);
            }, 2500);
            
        } catch (error) {
            addTestResult('æµ‹è¯•æ‰§è¡Œ', false, `é”™è¯¯: ${error.message}`);
            console.error(error);
        }
    </script>
</body>
</html>
