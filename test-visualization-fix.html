<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®—æ³•å¯è§†åŒ–æµ‹è¯• - ä¿®å¤ç‰ˆ</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">ğŸ§ª ç®—æ³•å¯è§†åŒ–æµ‹è¯• - ä¿®å¤ç‰ˆ</h1>
        
        <!-- ç®—æ³•é€‰æ‹© -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">é€‰æ‹©ç®—æ³•è¿›è¡Œæµ‹è¯•</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="testAlgorithm('bubble-sort')" class="px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                    ğŸ”µ å†’æ³¡æ’åº
                </button>
                <button onclick="testAlgorithm('quick-sort')" class="px-4 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                    âš¡ å¿«é€Ÿæ’åº
                </button>
                <button onclick="testAlgorithm('binary-search')" class="px-4 py-3 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition">
                    ğŸ” äºŒåˆ†æŸ¥æ‰¾
                </button>
                <button onclick="testAlgorithm('linear-search')" class="px-4 py-3 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition">
                    ğŸ” çº¿æ€§æœç´¢
                </button>
            </div>
        </div>

        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">æµ‹è¯•æ—¥å¿—</h2>
            <div id="test-log" class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm h-48 overflow-y-auto"></div>
        </div>

        <!-- å¯è§†åŒ–å®¹å™¨ -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">å¯è§†åŒ–æ¼”ç¤º</h2>
            <div id="visualizer-container" class="min-h-[400px]"></div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="utils/ErrorHandler.js"></script>
    <script src="algorithm-visualizer.js"></script>
    
    <script>
        let currentVisualizer = null;
        let testLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            const logMessage = `[${timestamp}] ${prefix} ${message}`;
            testLog.push(logMessage);
            
            const logElement = document.getElementById('test-log');
            logElement.innerHTML = testLog.slice(-20).join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logMessage);
        }

        function testAlgorithm(algorithmId) {
            log(`å¼€å§‹æµ‹è¯•ç®—æ³•: ${algorithmId}`);
            
            try {
                // æ¸…ç†æ—§çš„å¯è§†åŒ–å™¨
                if (currentVisualizer && typeof currentVisualizer.destroy === 'function') {
                    log('æ¸…ç†æ—§çš„å¯è§†åŒ–å™¨å®ä¾‹');
                    currentVisualizer.destroy();
                }
                
                // æ¸…ç©ºå®¹å™¨
                const container = document.getElementById('visualizer-container');
                container.innerHTML = '<div id="viz-test-container"></div>';
                
                log('å®¹å™¨å·²æ¸…ç©ºï¼Œç­‰å¾…DOMæ›´æ–°...');
                
                // ç­‰å¾…DOMæ›´æ–°
                setTimeout(() => {
                    try {
                        let visualizer;
                        
                        // æ ¹æ®ç®—æ³•ç±»å‹åˆ›å»ºå¯è§†åŒ–å™¨
                        if (algorithmId.includes('sort')) {
                            const algoType = algorithmId.replace('-sort', '');
                            log(`åˆ›å»ºæ’åºå¯è§†åŒ–å™¨: ${algoType}`);
                            
                            if (typeof SortingVisualizer === 'undefined') {
                                throw new Error('SortingVisualizerç±»æœªå®šä¹‰');
                            }
                            
                            visualizer = new SortingVisualizer('viz-test-container', algoType);
                            log('æ’åºå¯è§†åŒ–å™¨å®ä¾‹å·²åˆ›å»º', 'success');
                            
                        } else if (algorithmId.includes('search')) {
                            const algoType = algorithmId.replace('-search', '');
                            log(`åˆ›å»ºæœç´¢å¯è§†åŒ–å™¨: ${algoType}`);
                            
                            if (typeof SearchVisualizer === 'undefined') {
                                throw new Error('SearchVisualizerç±»æœªå®šä¹‰');
                            }
                            
                            visualizer = new SearchVisualizer('viz-test-container', algoType);
                            visualizer.setTarget(7);
                            log('æœç´¢å¯è§†åŒ–å™¨å®ä¾‹å·²åˆ›å»º', 'success');
                        }
                        
                        // åˆå§‹åŒ–å¯è§†åŒ–å™¨
                        log('åˆå§‹åŒ–å¯è§†åŒ–å™¨UI...');
                        visualizer.init();
                        log('UIåˆå§‹åŒ–å®Œæˆ', 'success');
                        
                        // è®¾ç½®æ•°æ®
                        if (algorithmId.includes('sort')) {
                            log('è®¾ç½®æ’åºæ•°æ®: [5, 3, 8, 2, 7, 1, 9, 4, 6]');
                            visualizer.setData([5, 3, 8, 2, 7, 1, 9, 4, 6]);
                        } else if (algorithmId.includes('search')) {
                            log('è®¾ç½®æœç´¢æ•°æ®: [1, 2, 3, 4, 5, 6, 7, 8, 9]');
                            visualizer.setData([1, 2, 3, 4, 5, 6, 7, 8, 9]);
                        }
                        
                        // é‡ç½®ä»¥ç”ŸæˆåŠ¨ç”»é˜Ÿåˆ—
                        log('é‡ç½®å¯è§†åŒ–å™¨ï¼Œç”ŸæˆåŠ¨ç”»é˜Ÿåˆ—...');
                        visualizer.reset();
                        
                        const queueLength = visualizer.animationQueue ? visualizer.animationQueue.length : 0;
                        log(`åŠ¨ç”»é˜Ÿåˆ—å·²ç”Ÿæˆï¼ŒåŒ…å« ${queueLength} ä¸ªæ­¥éª¤`, 'success');
                        
                        if (queueLength === 0) {
                            log('è­¦å‘Šï¼šåŠ¨ç”»é˜Ÿåˆ—ä¸ºç©ºï¼', 'error');
                        }
                        
                        // ä¿å­˜åˆ°å…¨å±€å˜é‡
                        currentVisualizer = visualizer;
                        window.visualizer = visualizer;
                        
                        log('å¯è§†åŒ–å™¨å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹æ¼”ç¤º', 'success');
                        log('-----------------------------------');
                        
                    } catch (error) {
                        log(`åˆ›å»ºå¯è§†åŒ–å™¨å¤±è´¥: ${error.message}`, 'error');
                        console.error('è¯¦ç»†é”™è¯¯:', error);
                    }
                }, 100);
                
            } catch (error) {
                log(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                console.error('è¯¦ç»†é”™è¯¯:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            log('æ£€æŸ¥å¿…éœ€çš„ç±»...');
            
            const classes = ['SortingVisualizer', 'SearchVisualizer', 'GraphVisualizer'];
            classes.forEach(className => {
                const exists = typeof window[className] !== 'undefined';
                log(`${className}: ${exists ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}`, exists ? 'success' : 'error');
            });
            
            log('-----------------------------------');
            log('è¯·é€‰æ‹©ä¸€ä¸ªç®—æ³•å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>
