<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ† CSP-J å¤‡è€ƒå­¦ä¹ åŠ©æ‰‹</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css" rel="stylesheet">
    <style>
        .code-font { font-family: 'Fira Code', 'Consolas', monospace; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        .detective { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            position: relative;
        }
        .detective::before {
            content: "ğŸ•µï¸";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
        }
        .speech-bubble {
            position: relative;
            background: white;
            border-radius: 20px;
            padding: 15px;
            margin-left: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .speech-bubble::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 20px;
            width: 0;
            height: 0;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid white;
        }
        .algorithm-viz {
            min-height: 200px;
            background: #1e293b;
            border-radius: 8px;
            padding: 20px;
            color: white;
            font-family: monospace;
        }
        .array-bar {
            display: inline-block;
            width: 30px;
            margin: 2px;
            text-align: center;
            color: white;
            font-weight: bold;
            transition: all 0.5s ease;
        }
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl">ğŸ†</span>
                    <h1 class="text-xl font-bold text-gray-800">CSP-J å¤‡è€ƒå­¦ä¹ åŠ©æ‰‹</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="bg-blue-100 px-3 py-1 rounded-full">
                        <span class="text-sm text-blue-800">å­¦ä¹ è¿›åº¦: <span id="overall-progress">0%</span></span>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- å­¦ä¹ ä¼™ä¼´æ¬¢è¿åŒº -->
    <div class="container mx-auto px-4 py-6">
        <div class="flex items-center mb-6">
            <div class="detective"></div>
            <div class="speech-bubble flex-1">
                <p id="detective-message" class="text-gray-700 font-medium">
                    ğŸ¯ æ¬¢è¿æ¥åˆ°CSP-Jå­¦ä¹ ä¸–ç•Œï¼æˆ‘æ˜¯ä½ çš„ä»£ç å°ä¾¦æ¢ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ç¼–ç¨‹çš„å¥¥ç§˜å§ï¼
                </p>
            </div>
        </div>
    </div>

    <!-- Tabå¯¼èˆª -->
    <div class="container mx-auto px-4">
        <div class="flex bg-white rounded-lg shadow-md mb-6 overflow-hidden">
            <button onclick="switchTab('knowledge')" id="tab-knowledge" class="tab-active px-6 py-3 font-medium flex-1 transition-all">
                ğŸ“š çŸ¥è¯†è®²è§£
            </button>
            <button onclick="switchTab('practice')" id="tab-practice" class="px-6 py-3 font-medium flex-1 transition-all hover:bg-gray-50">
                ğŸ’» ä»£ç ç»ƒä¹ 
            </button>
            <button onclick="switchTab('interactive')" id="tab-interactive" class="px-6 py-3 font-medium flex-1 transition-all hover:bg-gray-50">
                ğŸ® äº’åŠ¨ç»ƒä¹ 
            </button>
            <button onclick="switchTab('test')" id="tab-test" class="px-6 py-3 font-medium flex-1 transition-all hover:bg-gray-50">
                ğŸ“ æ¨¡æ‹Ÿæµ‹è¯•
            </button>
        </div>
    </div>

    <!-- ä¸»å­¦ä¹ åŒºåŸŸ -->
    <main class="container mx-auto px-4 pb-10">
        <!-- çŸ¥è¯†è®²è§£åŒº -->
        <div id="content-knowledge" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- çŸ¥è¯†ç‚¹åˆ—è¡¨ -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“‹ çŸ¥è¯†ç‚¹å¯¼èˆª</h3>
                        <div class="space-y-2" id="knowledge-nav">
                            <!-- åŠ¨æ€ç”ŸæˆçŸ¥è¯†ç‚¹å¯¼èˆª -->
                        </div>
                    </div>
                </div>
                <!-- çŸ¥è¯†ç‚¹è¯¦æƒ… -->
                <div class="lg:col-span-2">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div id="knowledge-content">
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">é€‰æ‹©å·¦ä¾§çŸ¥è¯†ç‚¹å¼€å§‹å­¦ä¹ </h2>
                            <p class="text-gray-600">ç‚¹å‡»å·¦ä¾§çŸ¥è¯†ç‚¹ï¼ŒæŸ¥çœ‹è¯¦ç»†è®²è§£å’Œä»£ç ç¤ºä¾‹ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä»£ç ç»ƒä¹ åŒº -->
        <div id="content-practice" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ’» ä»£ç ç¼–è¾‘å™¨</h3>
                    <div class="mb-4">
                        <select id="code-template" onchange="loadCodeTemplate()" class="w-full p-2 border rounded-md">
                            <option value="">é€‰æ‹©ä»£ç æ¨¡æ¿</option>
                            <option value="hello">Hello World</option>
                            <option value="input">è¾“å…¥è¾“å‡ºç¤ºä¾‹</option>
                        </select>
                    </div>
                    <textarea id="code-editor" class="w-full code-font h-64">#include <iostream>
using namespace std;

int main() {
    cout << "Hello, CSP-J!" << endl;
    return 0;
}</textarea>
                    <div class="mt-4 flex gap-2">
                        <button onclick="runCode()" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600">
                            â–¶ï¸ è¿è¡Œä»£ç 
                        </button>
                        <button onclick="clearCode()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600">
                            ğŸ—‘ï¸ æ¸…ç©ºä»£ç 
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“¤ è¿è¡Œç»“æœ</h3>
                    <div id="code-output" class="bg-gray-900 text-green-400 p-4 rounded-md code-font min-h-[200px]">
                        ç‚¹å‡»"è¿è¡Œä»£ç "æŸ¥çœ‹ç»“æœ...
                    </div>
                </div>
            </div>
        </div>

        <!-- äº’åŠ¨ç»ƒä¹ åŒº -->
        <div id="content-interactive" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ¯ ç®—æ³•å¯è§†åŒ–</h3>
                    <div class="mb-4">
                        <select id="algorithm-select" onchange="showAlgorithmViz()" class="w-full p-2 border rounded-md">
                            <option value="">é€‰æ‹©ç®—æ³•æ¼”ç¤º</option>
                            <option value="bubble-sort">å†’æ³¡æ’åº</option>
                            <option value="binary-search">äºŒåˆ†æŸ¥æ‰¾</option>
                        </select>
                    </div>
                    <div id="algorithm-visualization" class="algorithm-viz">
                        é€‰æ‹©ç®—æ³•æŸ¥çœ‹å¯è§†åŒ–æ¼”ç¤º...
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button onclick="startVisualization()" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
                            â–¶ï¸ å¼€å§‹æ¼”ç¤º
                        </button>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ§© ä»£ç å—æ‹¼æ¥</h3>
                    <div id="drag-drop-area" class="border-2 border-dashed border-gray-300 p-4 rounded-md min-h-[200px] mb-4">
                        <div class="text-center text-gray-500 py-8">
                            å°†ä»£ç å—æ‹–æ‹½åˆ°è¿™é‡Œ
                        </div>
                    </div>
                    <div id="code-blocks" class="grid grid-cols-2 gap-2">
                        <!-- åŠ¨æ€ç”Ÿæˆä»£ç å— -->
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡æ‹Ÿæµ‹è¯•åŒº -->
        <div id="content-test" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-gray-800">ğŸ“ CSP-J æ¨¡æ‹Ÿæµ‹è¯•</h3>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-red-500" id="test-timer">15:00</div>
                        <div class="text-sm text-gray-500">å‰©ä½™æ—¶é—´</div>
                    </div>
                </div>
                <div id="test-area">
                    <div class="text-center py-8">
                        <p class="text-gray-600 mb-4">å‡†å¤‡å¥½å‚åŠ CSP-Jæ¨¡æ‹Ÿæµ‹è¯•äº†å—ï¼Ÿ</p>
                        <button onclick="startTest()" class="bg-red-500 text-white px-6 py-3 rounded-md hover:bg-red-600">
                            ğŸš€ å¼€å§‹æµ‹è¯•
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ç»Ÿè®¡é¢æ¿ -->
    <footer class="bg-white shadow-lg mt-10">
        <div class="container mx-auto px-4 py-6">
            <div class="grid grid-cols-4 gap-6 text-center">
                <div>
                    <div class="text-2xl font-bold text-blue-600" id="mastered-count">0</div>
                    <div class="text-sm text-gray-600">å·²æŒæ¡çŸ¥è¯†ç‚¹</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-green-600" id="practice-count">0</div>
                    <div class="text-sm text-gray-600">å®Œæˆç»ƒä¹ é¢˜</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-purple-600" id="accuracy-rate">0%</div>
                    <div class="text-sm text-gray-600">æ­£ç¡®ç‡</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-orange-600" id="study-time">0</div>
                    <div class="text-sm text-gray-600">å­¦ä¹ æ—¶é•¿(åˆ†é’Ÿ)</div>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScriptåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>

    <script>
        // å…¨å±€çŠ¶æ€
        let gameState = {
            currentTab: 'knowledge',
            progress: {
                masteredTopics: new Set(),
                completedPractices: 0,
                correctAnswers: 0,
                totalAnswers: 0
            }
        };

        // çŸ¥è¯†ç‚¹æ•°æ®
        const knowledgeData = {
            'basics': {
                title: 'ğŸ å…¥é—¨åŸºç¡€',
                content: `
                    <h3>è®¡ç®—æœºåŸºç¡€çŸ¥è¯†</h3>
                    <p>äº†è§£è®¡ç®—æœºçš„åŸºæœ¬ç»„æˆå’Œå·¥ä½œåŸç†æ˜¯å­¦ä¹ ç¼–ç¨‹çš„ç¬¬ä¸€æ­¥ã€‚</p>
                    <h4>ğŸ¯ é‡è¦çŸ¥è¯†ç‚¹ï¼š</h4>
                    <ul class="list-disc pl-6 space-y-2">
                        <li><strong>CCF ç®€ä»‹</strong>ï¼šä¸­å›½è®¡ç®—æœºå­¦ä¼šæˆç«‹äº1962å¹´</li>
                        <li><strong>CSP-J/S</strong>ï¼šéä¸“ä¸šçº§è½¯ä»¶èƒ½åŠ›è®¤è¯</li>
                        <li><strong>è€ƒè¯•è§„åˆ™</strong>ï¼šç¦æ­¢æºå¸¦ç”µå­è®¾å¤‡ï¼Œå…è®¸æŒ‡å®šèµ„æ–™</li>
                        <li><strong>å†å²äººç‰©</strong>ï¼šå†¯Â·è¯ºä¾æ›¼æå‡ºå­˜å‚¨ç¨‹åºåŸç†(1946)</li>
                        <li><strong>å›¾çµå¥–</strong>ï¼šè®¡ç®—æœºé¢†åŸŸæœ€é«˜å¥–é¡¹</li>
                    </ul>
                `
            },
            'number-systems': {
                title: 'ğŸ”¢ è¿›åˆ¶ä¸æ•°æ®è¡¨ç¤º',
                content: `
                    <h3>æ•°åˆ¶è½¬æ¢ä¸æ•°æ®è¡¨ç¤º</h3>
                    <p>è®¡ç®—æœºä½¿ç”¨äºŒè¿›åˆ¶å­˜å‚¨å’Œå¤„ç†æ‰€æœ‰æ•°æ®ã€‚</p>
                    <h4>ğŸ¯ é‡è¦æ¦‚å¿µï¼š</h4>
                    <ul class="list-disc pl-6 space-y-2">
                        <li><strong>äºŒè¿›åˆ¶</strong>ï¼šä»¥0bå¼€å¤´ï¼Œå¦‚0b1010</li>
                        <li><strong>å…«è¿›åˆ¶</strong>ï¼šä»¥0å¼€å¤´ï¼Œå¦‚0123</li>
                        <li><strong>åå…­è¿›åˆ¶</strong>ï¼šä»¥0xå¼€å¤´ï¼Œå¦‚0xFF</li>
                        <li><strong>è¡¥ç </strong>ï¼šè¡¨ç¤ºæœ‰ç¬¦å·æ•´æ•°çš„æ–¹æ³•</li>
                    </ul>
                `
            }
        };

        // ä»£ç æ¨¡æ¿
        const codeTemplates = {
            hello: `#include <iostream>
using namespace std;

int main() {
    cout << "Hello, CSP-J!" << endl;
    return 0;
}`,
            input: `#include <iostream>
using namespace std;

int main() {
    int a, b;
    cout << "è¯·è¾“å…¥ä¸¤ä¸ªæ•°ï¼š";
    cin >> a >> b;
    cout << "ä½ è¾“å…¥çš„æ•°æ˜¯ï¼š" << a << " å’Œ " << b << endl;
    return 0;
}`
        };

        // æµ‹è¯•é¢˜ç›®
        const testQuestions = [
            {
                id: 1,
                question: "CCFï¼ˆä¸­å›½è®¡ç®—æœºå­¦ä¼šï¼‰æˆç«‹äºå“ªä¸€å¹´ï¼Ÿ",
                options: ["A. 1960", "B. 1962", "C. 1965", "D. 1970"],
                answer: 1,
                explanation: "ä¸­å›½è®¡ç®—æœºå­¦ä¼šæˆç«‹äº1962å¹´ã€‚"
            },
            {
                id: 2,
                question: "ä»¥ä¸‹å“ªä¸ªæ˜¯C++ç¨‹åºçš„æ­£ç¡®å…¥å£å‡½æ•°ï¼Ÿ",
                options: ["A. void main()", "B. int main()", "C. main()", "D. start()"],
                answer: 1,
                explanation: "C++ç¨‹åºçš„æ ‡å‡†å…¥å£å‡½æ•°æ˜¯ int main()ã€‚"
            }
        ];

        // Tabåˆ‡æ¢
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // æ›´æ–°tabæ ·å¼
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.className = tab.className.replace('tab-active', '');
                if (!tab.className.includes('hover:bg-gray-50')) {
                    tab.className += ' hover:bg-gray-50';
                }
            });
            
            const activeTab = document.getElementById(`tab-${tabName}`);
            if (activeTab) {
                activeTab.className = 'tab-active px-6 py-3 font-medium flex-1 transition-all';
            }
            
            // æ˜¾ç¤ºå¯¹åº”å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            const activeContent = document.getElementById(`content-${tabName}`);
            if (activeContent) {
                activeContent.classList.remove('hidden');
            }
            
            gameState.currentTab = tabName;
            updateDetectiveMessage(`åˆ‡æ¢åˆ°${tabName}æ ‡ç­¾é¡µ`);
        }

        // ç”ŸæˆçŸ¥è¯†ç‚¹å¯¼èˆª
        function generateKnowledgeNav() {
            console.log('Generating knowledge navigation...');
            const navContainer = document.getElementById('knowledge-nav');
            
            if (!navContainer) {
                console.error('Knowledge nav container not found!');
                return;
            }
            
            navContainer.innerHTML = '';
            
            Object.keys(knowledgeData).forEach(key => {
                const topic = knowledgeData[key];
                const isCompleted = gameState.progress.masteredTopics.has(key);
                
                const navItem = document.createElement('div');
                navItem.className = `p-3 rounded-md cursor-pointer transition-all ${isCompleted ? 'bg-green-100 text-green-800' : 'bg-gray-100 hover:bg-gray-200'}`;
                navItem.innerHTML = `
                    <div class="flex items-center justify-between">
                        <span>${topic.title}</span>
                        ${isCompleted ? '<span class="text-green-600">âœ“</span>' : '<span class="text-gray-400">â—‹</span>'}
                    </div>
                `;
                navItem.onclick = () => showKnowledge(key);
                navContainer.appendChild(navItem);
            });
            
            console.log(`Generated ${Object.keys(knowledgeData).length} knowledge nav items`);
        }

        // æ˜¾ç¤ºçŸ¥è¯†ç‚¹å†…å®¹
        function showKnowledge(topicKey) {
            console.log('Showing knowledge for:', topicKey);
            const topic = knowledgeData[topicKey];
            const contentContainer = document.getElementById('knowledge-content');
            
            if (!topic || !contentContainer) {
                console.error('Topic or content container not found');
                return;
            }
            
            contentContainer.innerHTML = `
                <h2 class="text-2xl font-bold text-gray-800 mb-4">${topic.title}</h2>
                <div class="prose max-w-none">${topic.content}</div>
                <div class="mt-6">
                    <button onclick="markTopicCompleted('${topicKey}')" class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors">
                        âœ… æ ‡è®°ä¸ºå·²æŒæ¡
                    </button>
                </div>
            `;
            
            updateDetectiveMessage(`æ­£åœ¨å­¦ä¹ : ${topic.title}`);
        }

        // æ ‡è®°çŸ¥è¯†ç‚¹å®Œæˆ
        function markTopicCompleted(topicKey) {
            console.log('Marking topic completed:', topicKey);
            gameState.progress.masteredTopics.add(topicKey);
            generateKnowledgeNav();
            updateStats();
            updateDetectiveMessage("å¤ªæ£’äº†ï¼åˆæŒæ¡äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ğŸ†");
        }

        // åŠ è½½ä»£ç æ¨¡æ¿
        function loadCodeTemplate() {
            console.log('Loading code template...');
            const select = document.getElementById('code-template');
            const textarea = document.getElementById('code-editor');
            
            if (!select || !textarea) {
                console.error('Template select or editor not found');
                return;
            }
            
            const template = codeTemplates[select.value];
            if (template) {
                textarea.value = template;
                updateDetectiveMessage("æ¨¡æ¿åŠ è½½å®Œæˆï¼è¯•è¯•è¿è¡Œè¿™æ®µä»£ç å§ï¼âš¡");
            }
        }

        // è¿è¡Œä»£ç 
        function runCode() {
            console.log('Running code...');
            const textarea = document.getElementById('code-editor');
            const outputDiv = document.getElementById('code-output');
            
            if (!textarea || !outputDiv) {
                console.error('Editor or output div not found');
                return;
            }
            
            const code = textarea.value.trim();
            if (!code) {
                outputDiv.textContent = 'è¯·è¾“å…¥ä»£ç åå†è¿è¡Œï¼';
                return;
            }
            
            // æ¨¡æ‹Ÿä»£ç æ‰§è¡Œ
            let output = 'ç¨‹åºæ‰§è¡Œå®Œæˆ';
            if (code.includes('cout') && code.includes('Hello')) {
                output = 'Hello, CSP-J!';
            } else if (code.includes('cout') && code.includes('cin')) {
                output = 'è¯·è¾“å…¥ä¸¤ä¸ªæ•°ï¼š\nä½ è¾“å…¥çš„æ•°æ˜¯ï¼š10 å’Œ 20';
            }
            
            outputDiv.textContent = output;
            gameState.progress.completedPractices++;
            updateStats();
            updateDetectiveMessage("ä»£ç è¿è¡ŒæˆåŠŸï¼ç»§ç»­åŠ æ²¹ï¼ğŸš€");
        }

        // æ¸…ç©ºä»£ç 
        function clearCode() {
            console.log('Clearing code...');
            const textarea = document.getElementById('code-editor');
            const outputDiv = document.getElementById('code-output');
            
            if (textarea) textarea.value = '';
            if (outputDiv) outputDiv.textContent = 'ç‚¹å‡»"è¿è¡Œä»£ç "æŸ¥çœ‹ç»“æœ...';
            
            updateDetectiveMessage("ç¼–è¾‘å™¨å·²æ¸…ç©ºï¼Œå‡†å¤‡å†™æ–°ä»£ç å§ï¼âœ¨");
        }

        // æ˜¾ç¤ºç®—æ³•å¯è§†åŒ–
        function showAlgorithmViz() {
            console.log('Showing algorithm visualization...');
            const select = document.getElementById('algorithm-select');
            const vizArea = document.getElementById('algorithm-visualization');
            
            if (!select || !vizArea) {
                console.error('Algorithm select or viz area not found');
                return;
            }
            
            switch(select.value) {
                case 'bubble-sort':
                    vizArea.innerHTML = `
                        <div class="text-center mb-4">
                            <h4 class="text-lg font-bold mb-2">å†’æ³¡æ’åºå¯è§†åŒ–</h4>
                            <p class="text-sm text-gray-300">æ¯”è¾ƒç›¸é‚»å…ƒç´ ï¼Œå¤§çš„å‘å"å†’æ³¡"</p>
                        </div>
                        <div id="sort-array" class="text-center">
                            <div class="array-bar" style="height: 64px; background-color: #3b82f6;">64</div>
                            <div class="array-bar" style="height: 34px; background-color: #3b82f6;">34</div>
                            <div class="array-bar" style="height: 25px; background-color: #3b82f6;">25</div>
                            <div class="array-bar" style="height: 12px; background-color: #3b82f6;">12</div>
                        </div>
                    `;
                    break;
                case 'binary-search':
                    vizArea.innerHTML = `
                        <div class="text-center mb-4">
                            <h4 class="text-lg font-bold mb-2">äºŒåˆ†æŸ¥æ‰¾å¯è§†åŒ–</h4>
                            <p class="text-sm text-gray-300">åœ¨æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ç›®æ ‡å€¼</p>
                        </div>
                        <div id="search-array" class="text-center">
                            <div class="array-bar" style="height: 40px; background-color: #10b981;">1</div>
                            <div class="array-bar" style="height: 40px; background-color: #10b981;">3</div>
                            <div class="array-bar" style="height: 40px; background-color: #10b981;">5</div>
                            <div class="array-bar" style="height: 40px; background-color: #10b981;">7</div>
                        </div>
                        <div class="mt-4 text-center">
                            <p class="text-sm">æŸ¥æ‰¾ç›®æ ‡ï¼š<span class="font-bold text-yellow-400">5</span></p>
                        </div>
                    `;
                    break;
                default:
                    vizArea.innerHTML = 'é€‰æ‹©ç®—æ³•æŸ¥çœ‹å¯è§†åŒ–æ¼”ç¤º...';
            }
        }

        // å¼€å§‹å¯è§†åŒ–æ¼”ç¤º
        function startVisualization() {
            console.log('Starting visualization...');
            const select = document.getElementById('algorithm-select');
            
            if (!select || !select.value) {
                updateDetectiveMessage("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç®—æ³•ï¼ğŸ¤”");
                return;
            }
            
            updateDetectiveMessage(`å¼€å§‹${select.options[select.selectedIndex].text}æ¼”ç¤ºï¼ğŸ¯`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„åŠ¨ç”»é€»è¾‘
        }

        // åˆå§‹åŒ–æ‹–æ‹½ç»ƒä¹ 
        function initDragDropPractice() {
            console.log('Initializing drag drop practice...');
            const codeBlocks = [
                '#include <iostream>',
                'using namespace std;',
                'int main() {',
                '    cout << "Hello World" << endl;',
                '    return 0;',
                '}'
            ];
            
            const blocksContainer = document.getElementById('code-blocks');
            if (!blocksContainer) {
                console.error('Code blocks container not found');
                return;
            }
            
            blocksContainer.innerHTML = '';
            
            codeBlocks.forEach((block, index) => {
                const blockDiv = document.createElement('div');
                blockDiv.className = 'bg-blue-100 p-2 rounded cursor-move border border-blue-300 code-font text-sm';
                blockDiv.textContent = block;
                blockDiv.draggable = true;
                blocksContainer.appendChild(blockDiv);
            });
        }

        // å¼€å§‹æµ‹è¯•
        function startTest() {
            console.log('Starting test...');
            gameState.currentTest = {
                questions: [...testQuestions].slice(0, 2), // ç®€åŒ–ä¸º2é¢˜
                currentQuestionIndex: 0,
                answers: [],
                startTime: Date.now()
            };
            
            showTestQuestion();
        }

        // æ˜¾ç¤ºæµ‹è¯•é¢˜ç›®
        function showTestQuestion() {
            console.log('Showing test question...');
            const test = gameState.currentTest;
            const question = test.questions[test.currentQuestionIndex];
            const testArea = document.getElementById('test-area');
            
            if (!testArea || !question) {
                console.error('Test area or question not found');
                return;
            }
            
            testArea.innerHTML = `
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold">ç¬¬ ${test.currentQuestionIndex + 1} é¢˜ / å…± ${test.questions.length} é¢˜</h4>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <p class="text-lg mb-4">${question.question}</p>
                        <div class="space-y-2">
                            ${question.options.map((option, index) => `
                                <label class="flex items-center space-x-2 p-2 rounded hover:bg-gray-100 cursor-pointer">
                                    <input type="radio" name="question-${question.id}" value="${index}" class="w-4 h-4">
                                    <span>${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <button onclick="prevQuestion()" class="bg-gray-500 text-white px-4 py-2 rounded-md hover:bg-gray-600" ${test.currentQuestionIndex === 0 ? 'disabled' : ''}>
                            â† ä¸Šä¸€é¢˜
                        </button>
                        <button onclick="nextQuestion()" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">
                            ${test.currentQuestionIndex === test.questions.length - 1 ? 'æäº¤ç­”æ¡ˆ' : 'ä¸‹ä¸€é¢˜ â†’'}
                        </button>
                    </div>
                </div>
            `;
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            console.log('Next question...');
            const test = gameState.currentTest;
            if (!test) return;
            
            if (test.currentQuestionIndex < test.questions.length - 1) {
                test.currentQuestionIndex++;
                showTestQuestion();
            } else {
                finishTest();
            }
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            console.log('Previous question...');
            const test = gameState.currentTest;
            if (!test || test.currentQuestionIndex === 0) return;
            
            test.currentQuestionIndex--;
            showTestQuestion();
        }

        // å®Œæˆæµ‹è¯•
        function finishTest() {
            console.log('Finishing test...');
            const testArea = document.getElementById('test-area');
            if (!testArea) return;
            
            testArea.innerHTML = `
                <div class="text-center py-8">
                    <h3 class="text-xl font-bold mb-4">æµ‹è¯•å®Œæˆï¼</h3>
                    <p class="text-gray-600 mb-4">æ„Ÿè°¢å‚åŠ CSP-Jæ¨¡æ‹Ÿæµ‹è¯•ã€‚</p>
                    <button onclick="resetTest()" class="bg-blue-500 text-white px-6 py-3 rounded-md hover:bg-blue-600">
                        é‡æ–°æµ‹è¯•
                    </button>
                </div>
            `;
            
            updateDetectiveMessage("æµ‹è¯•å®Œæˆï¼ç»§ç»­åŠ æ²¹å­¦ä¹ å§ï¼ğŸ“š");
        }

        // é‡ç½®æµ‹è¯•
        function resetTest() {
            console.log('Resetting test...');
            const testArea = document.getElementById('test-area');
            if (!testArea) return;
            
            testArea.innerHTML = `
                <div class="text-center py-8">
                    <p class="text-gray-600 mb-4">å‡†å¤‡å¥½å‚åŠ CSP-Jæ¨¡æ‹Ÿæµ‹è¯•äº†å—ï¼Ÿ</p>
                    <button onclick="startTest()" class="bg-red-500 text-white px-6 py-3 rounded-md hover:bg-red-600">
                        ğŸš€ å¼€å§‹æµ‹è¯•
                    </button>
                </div>
            `;
            
            gameState.currentTest = null;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const masteredCount = document.getElementById('mastered-count');
            const practiceCount = document.getElementById('practice-count');
            const accuracyRate = document.getElementById('accuracy-rate');
            
            if (masteredCount) {
                masteredCount.textContent = gameState.progress.masteredTopics.size;
            }
            if (practiceCount) {
                practiceCount.textContent = gameState.progress.completedPractices;
            }
            if (accuracyRate) {
                const rate = gameState.progress.totalAnswers > 0 ? 
                    Math.round((gameState.progress.correctAnswers / gameState.progress.totalAnswers) * 100) : 0;
                accuracyRate.textContent = rate + '%';
            }
        }

        // æ›´æ–°ä¾¦æ¢æ¶ˆæ¯
        function updateDetectiveMessage(message) {
            const messageElement = document.getElementById('detective-message');
            if (messageElement) {
                messageElement.textContent = message;
            }
            console.log('Detective message:', message);
        }

        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            console.log('Initializing CSP-J Learning Tool...');
            
            try {
                // ç”ŸæˆçŸ¥è¯†ç‚¹å¯¼èˆª
                generateKnowledgeNav();
                console.log('âœ“ Knowledge navigation generated');
                
                // åˆå§‹åŒ–æ‹–æ‹½ç»ƒä¹ 
                initDragDropPractice();
                console.log('âœ“ Drag drop practice initialized');
                
                // æ›´æ–°ç»Ÿè®¡
                updateStats();
                console.log('âœ“ Stats updated');
                
                // æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯
                updateDetectiveMessage('ğŸ¯ æ¬¢è¿æ¥åˆ°CSP-Jå­¦ä¹ ä¸–ç•Œï¼æˆ‘æ˜¯ä½ çš„ä»£ç å°ä¾¦æ¢ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ç¼–ç¨‹çš„å¥¥ç§˜å§ï¼');
                console.log('âœ“ Welcome message displayed');
                
                console.log('ğŸš€ CSP-J Learning Tool initialized successfully!');
                
            } catch (error) {
                console.error('âŒ Error initializing app:', error);
                updateDetectiveMessage('åˆå§‹åŒ–é‡åˆ°é—®é¢˜ï¼Œä½†åˆ«æ‹…å¿ƒï¼Œä¸»è¦åŠŸèƒ½ä»å¯ä½¿ç”¨ï¼');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            initializeApp();
        });

        // å…¨å±€å‡½æ•°æš´éœ²
        window.switchTab = switchTab;
        window.generateKnowledgeNav = generateKnowledgeNav;
        window.showKnowledge = showKnowledge;
        window.markTopicCompleted = markTopicCompleted;
        window.loadCodeTemplate = loadCodeTemplate;
        window.runCode = runCode;
        window.clearCode = clearCode;
        window.showAlgorithmViz = showAlgorithmViz;
        window.startVisualization = startVisualization;
        window.startTest = startTest;
        window.nextQuestion = nextQuestion;
        window.prevQuestion = prevQuestion;
        window.resetTest = resetTest;
        
        console.log('All functions exposed to global scope');

    </script>
</body>
</html>