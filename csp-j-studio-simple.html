<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSP-J Algorithm Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .tab-btn {
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5);
        }

        .algo-card {
            transition: transform 0.2s;
        }

        .algo-card:hover {
            transform: translateY(-2px);
        }

        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 50%;

            let formatted=line .replace(/</g, '&lt;').replace(/>/g, '&gt;') .replace(/\/\/.*/g, match=> `<span class="cpp-comment" >$ {
                    match
                }

                </span>`) .replace(/\b(int|void|bool|double|float|char|long)\b/g, '<span class="cpp-type">$1</span>') .replace(/\b(if|else|for|while|return|break|continue|using|namespace|include)\b/g, '<span class="cpp-keyword">$1</span>') .replace(/\b(\d+)\b/g, '<span class="cpp-number">$1</span>');

            return `<div class="code-line" id="line-${idx}">$ {
                formatted
            }

            </div>`;
        }).join('');
        }

        renderBars(arr, activeIndices=[], sortedIndices=[]) {
            this.canvas.innerHTML='';
            const max=Math.max(...arr, 1);

            arr.forEach((val, idx)=> {
                    const bar=document.createElement('div');
                    const height=(val / max) * 100;

                    let colorClass='bg-blue-500';
                    if (activeIndices.includes(idx)) colorClass='bg-red-500 scale-110 shadow-lg z-10'; // Highlight active
                    else if (sortedIndices.includes(idx)) colorClass='bg-green-500 opacity-80'; // Sorted

                    bar.className=`w-12 transition-all duration-500 rounded-t-lg relative $ {
                        colorClass
                    }

                    flex justify-center`;

                    bar.style.height=`$ {
                        height
                    }

                    %`;

                    const label=document.createElement('div');
                    label.className='bar-label';
                    label.innerText=val;

                    bar.appendChild(label);
                    this.canvas.appendChild(bar);
                });
        }

        renderBoxes(arr, activeIdx=-1, foundIdx=-1, range= {
                start: -1, end: -1

            }) {
            this.canvas.innerHTML='';
            this.canvas.className="flex-1 flex items-center justify-center gap-3 min-h-[400px] pb-8 relative flex-wrap content-center";

            arr.forEach((val, idx)=> {
                    const box=document.createElement('div');
                    let bg='bg-white border-2 border-gray-300 text-gray-700';

                    // Dim out of range elements for binary search
                    if (range.start !==-1 && (idx < range.start || idx > range.end)) {
                        bg='bg-gray-100 border-gray-200 text-gray-300';
                    }

                    if (idx===foundIdx) bg='bg-green-500 border-green-600 text-white shadow-lg scale-110 z-10';
                    else if (idx===activeIdx) bg='bg-red-500 border-red-600 text-white shadow-lg scale-110 z-10';

                    box.className=`$ {
                        bg
                    }

                    w-14 h-14 flex items-center justify-center text-xl font-bold rounded-lg transition-all duration-500 relative`;
                    box.innerText=val;

                    const idxLabel=document.createElement('div');
                    idxLabel.className='absolute -bottom-6 text-xs text-gray-400 font-mono';
                    idxLabel.innerText=idx;
                    box.appendChild(idxLabel);

                    this.canvas.appendChild(box);
                });
        }
        }

        // --- Application Logic ---
        const app= {
            currentAlgo: null,

            algorithms: [ {

                id: 'bubble',
                name: 'å†’æ³¡æ’åº (Bubble Sort)',
                type: 'sort',
                desc: 'é€šè¿‡é‡å¤äº¤æ¢ç›¸é‚»çš„é€†åºå…ƒç´ æ¥æ’åºã€‚æ—¶é—´å¤æ‚åº¦ O(nÂ²)ã€‚',
                code: `void bubbleSort(int arr[], int n) {

                    // å¤–å±‚å¾ªç¯æ§åˆ¶æ’åºè½®æ•°
                    for (int i=0; i < n - 1; i++) {

                        // å†…å±‚å¾ªç¯è¿›è¡Œç›¸é‚»å…ƒç´ æ¯”è¾ƒ
                        for (int j=0; j < n - i - 1; j++) {

                            // å¦‚æœå‰ä¸€ä¸ªå…ƒç´ å¤§äºåä¸€ä¸ª
                            if (arr[j] > arr[j + 1]) {
                                // äº¤æ¢ä¸¤ä¸ªå…ƒç´ 
                                swap(arr[j], arr[j + 1]);
                            }
                        }

                        // ç¬¬ i è½®ç»“æŸåï¼Œæœ€å¤§çš„å…ƒç´ å·²å½’ä½
                    }
                }

                `
            }

            ,
            {

            id: 'selection',
            name: 'é€‰æ‹©æ’åº (Selection Sort)',
            type: 'sort',
            desc: 'æ¯æ¬¡ä»æœªæ’åºéƒ¨åˆ†é€‰æ‹©æœ€å°å…ƒç´ æ”¾åˆ°å·²æ’åºéƒ¨åˆ†æœ«å°¾ã€‚æ—¶é—´å¤æ‚åº¦ O(nÂ²)ã€‚',
            code: `void selectionSort(int arr[], int n) {
                for (int i=0; i < n - 1; i++) {
                    // å‡è®¾å½“å‰ä½ç½® i æ˜¯æœ€å°å€¼ç´¢å¼•
                    int min_idx=i;

                    // åœ¨æœªæ’åºéƒ¨åˆ†å¯»æ‰¾çœŸæ­£çš„æœ€å°å€¼
                    for (int j=i + 1; j < n; j++) {
                        if (arr[j] < arr[min_idx]) {
                            min_idx=j;
                        }
                    }

                    // å°†æ‰¾åˆ°çš„æœ€å°å€¼äº¤æ¢åˆ°ä½ç½® i
                    swap(arr[min_idx], arr[i]);
                }
            }

            `
        }

        ,
        {

        id: 'insertion',
        name: 'æ’å…¥æ’åº (Insertion Sort)',
        type: 'sort',
        desc: 'æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚',
        code: `void insertionSort(int arr[], int n) {
            for (int i=1; i < n; i++) {
                int key=arr[i]; // å¾…æ’å…¥å…ƒç´ 
                int j=i - 1;

                // å°†å¤§äº key çš„å…ƒç´ å‘åç§»åŠ¨
                while (j >=0 && arr[j] > key) {
                    arr[j+1]=arr[j];
                    j=j - 1;
                }

                // æ’å…¥ key åˆ°æ­£ç¡®ä½ç½®
                arr[j+1]=key;
            }
        }

        `
        }

        ,
        {

        id: 'linear',
        name: 'çº¿æ€§æŸ¥æ‰¾ (Linear Search)',
        type: 'search',
        desc: 'ä»å¤´åˆ°å°¾ä¾æ¬¡æŸ¥æ‰¾ç›®æ ‡å…ƒç´ ã€‚æ—¶é—´å¤æ‚åº¦ O(n)ã€‚',
        code: `int linearSearch(int arr[], int n, int x) {

            // éå†æ•°ç»„æ¯ä¸ªå…ƒç´ 
            for (int i=0; i < n; i++) {

                // æ£€æŸ¥å½“å‰å…ƒç´ æ˜¯å¦ç­‰äºç›®æ ‡å€¼
                if (arr[i]==x) {
                    return i; // æ‰¾åˆ°ç›®æ ‡ï¼Œè¿”å›ç´¢å¼•
                }
            }

            return -1; // æœªæ‰¾åˆ°
        }

        `
        }

        ,
        {

        id: 'binary',
        name: 'äºŒåˆ†æŸ¥æ‰¾ (Binary Search)',
        type: 'search',
        desc: 'åœ¨æœ‰åºæ•°ç»„ä¸­é€šè¿‡æŠ˜åŠæŸ¥æ‰¾ç›®æ ‡å…ƒç´ ã€‚æ—¶é—´å¤æ‚åº¦ O(log n)ã€‚',
        code: `int binarySearch(int arr[], int l, int r, int x) {
            while (l <=r) {
                // è®¡ç®—ä¸­é—´ç´¢å¼•
                int m=l+(r - l) / 2;

                // æ£€æŸ¥ä¸­é—´å…ƒç´ æ˜¯å¦æ˜¯ç›®æ ‡å€¼
                if (arr[m]==x) return m;

                // å¦‚æœç›®æ ‡å€¼æ›´å¤§ï¼Œå¿½ç•¥å·¦åŠéƒ¨åˆ†
                if (arr[m] < x) l=m+1;

                // å¦‚æœç›®æ ‡å€¼æ›´å°ï¼Œå¿½ç•¥å³åŠéƒ¨åˆ†
                else r=m - 1;
            }

            return -1; // æœªæ‰¾åˆ°
        }

        `
        }

        ],

        init() {
            this.renderList();
            window.viz=new VisualizerEngine('viz-canvas', 'viz-status', 'code-display');
        }

        ,

        renderList() {
            const container=document.getElementById('view-list');

            container.innerHTML=this.algorithms.map(algo=> ` <div onclick="app.selectAlgo('${algo.id}')" class="algo-card bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-md cursor-pointer group" > <div class="flex justify-between items-start mb-4" > <div class="p-3 rounded-lg ${algo.type === 'sort' ? 'bg-blue-100 text-blue-600' : 'bg-purple-100 text-purple-600'}" > $ {
                    algo.type==='sort' ? 'ğŸ“Š' : 'ğŸ”'
                }

                </div> <span class="text-xs font-bold px-2 py-1 rounded bg-gray-100 text-gray-500 uppercase" >$ {
                    algo.type
                }

                </span> </div> <h3 class="text-xl font-bold text-gray-800 mb-2 group-hover:text-blue-600 transition" >$ {
                    algo.name
                }

                </h3> <p class="text-gray-500 text-sm" >$ {
                    algo.desc
                }

                </p> </div> `).join('');
        }

        ,

        switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b=> b.classList.remove('active'));

            document.getElementById(`tab-$ {
                    tab
                }

                `).classList.add('active');

            document.getElementById('view-list').classList.add('hidden');
            document.getElementById('view-viz').classList.add('hidden');

            document.getElementById(`view-$ {
                    tab
                }

                `).classList.remove('hidden');
        }

        ,

        selectAlgo(id) {
            this.currentAlgo=this.algorithms.find(a=> a.id===id);
            document.getElementById('viz-title').innerText=this.currentAlgo.name;
            this.switchTab('viz');

            // Render Code
            viz.renderCode(this.currentAlgo.code);
            viz.highlightCode(-1); // Clear highlight

            // Setup initial state based on algo type
            if (this.currentAlgo.type==='sort') {
                viz.data=[64,
                34,
                25,
                12,
                22,
                11,
                90];
                viz.renderBars(viz.data);
                viz.mode='sort';
            }

            else {
                viz.data=[10,
                20,
                30,
                40,
                50,
                60,
                70,
                80,
                90];
                viz.target=40;
                viz.renderBoxes(viz.data);
                viz.mode='search';
            }

            viz.log(`å·²åŠ è½½ $ {
                    this.currentAlgo.name
                }

                ï¼Œç‚¹å‡»è¿è¡Œå¼€å§‹æ¼”ç¤º`);

            // Attach specific start function
            viz.start=async ()=> {
                if (viz.isRunning) return;
                viz.isRunning=true;

                if (id==='bubble') await this.runBubbleSort();
                else if (id==='selection') await this.runSelectionSort();
                else if (id==='insertion') await this.runInsertionSort();
                else if (id==='linear') await this.runLinearSearch();
                else if (id==='binary') await this.runBinarySearch();

                viz.isRunning=false;
            }

            ;

            viz.reset=()=> {
                viz.isRunning=false;
                this.selectAlgo(id); // Reload
            }

            ;
        }

        ,

        // --- Algorithms Implementation with Code Sync ---

        async runBubbleSort() {
            let arr=[...viz.data];
            let n=arr.length;

            viz.highlightCode(0); // void bubbleSort...
            await viz.wait();

            for (let i=0; i < n - 1; i++) {
                viz.highlightCode(2); // for i
                await viz.wait();

                for (let j=0; j < n - i - 1; j++) {
                    if ( !viz.isRunning) return;

                    viz.highlightCode(4); // for j

                    viz.log(`æ¯”è¾ƒ arr[$ {
                            j
                        }

                        ] ($ {
                                arr[j]

                            }) å’Œ arr[$ {
                            j + 1
                        }

                        ] ($ {
                                arr[j + 1]
                            })`);
                    viz.renderBars(arr, [j, j + 1], []);
                    await viz.wait();

                    viz.highlightCode(6); // if (arr[j] > arr[j+1])

                    if (arr[j] > arr[j + 1]) {
                        viz.log(`äº¤æ¢ $ {
                                arr[j]
                            }

                            å’Œ $ {
                                arr[j + 1]
                            }

                            `);
                        viz.highlightCode(8); // swap
                        let temp=arr[j];
                        arr[j]=arr[j+1];
                        arr[j+1]=temp;
                        viz.renderBars(arr, [j, j + 1], []);
                        await viz.wait();
                    }
                }

                // Mark sorted
                viz.highlightCode(11); // end of i loop
            }

            viz.renderBars(arr, [], arr.map((_, i)=> i)); // All green
            viz.highlightCode(12); // end function
            viz.log("âœ… æ’åºå®Œæˆ");
        }

        ,

        async runSelectionSort() {
            let arr=[...viz.data];
            let n=arr.length;

            viz.highlightCode(0);
            await viz.wait();

            for (let i=0; i < n - 1; i++) {
                viz.highlightCode(1); // for i
                let min_idx=i;

                viz.highlightCode(3); // int min_idx = i

                viz.renderBars(arr, [i], Array.from({
                        length: i
                    }

                    , (_, k)=> k));

            viz.log(`å½“å‰æœ€å°å€¼ç´¢å¼• min_idx=$ {
                    i
                }

                `);
            await viz.wait();

            for (let j=i + 1; j < n; j++) {
                if ( !viz.isRunning) return;

                viz.highlightCode(6); // for j

                viz.renderBars(arr, [j, min_idx], Array.from({
                        length: i
                    }

                    , (_, k)=> k));
            await viz.wait();

            viz.highlightCode(7); // if (arr[j] < arr[min_idx])

            if (arr[j] < arr[min_idx]) {
                min_idx=j;
                viz.highlightCode(8); // min_idx = j

                viz.log(`å‘ç°æ›´å°å€¼ $ {
                        arr[j]
                    }

                    ï¼Œæ›´æ–° min_idx=$ {
                        j
                    }

                    `);
                await viz.wait();
            }
        }

        viz.highlightCode(13); // swap

        if (min_idx !==i) {
            viz.log(`äº¤æ¢ arr[$ {
                    i
                }

                ] å’Œ arr[$ {
                    min_idx
                }

                ]`);
            [arr[i],
            arr[min_idx]]=[arr[min_idx],
            arr[i]];
            viz.renderBars(arr, [i, min_idx], []);
            await viz.wait();
        }
        }

        viz.renderBars(arr, [], arr.map((_, i)=> i));
        viz.log("âœ… æ’åºå®Œæˆ");
        }

        ,

        async runInsertionSort() {
            let arr=[...viz.data];
            let n=arr.length;

            viz.highlightCode(0);
            await viz.wait();

            for (let i=1; i < n; i++) {
                viz.highlightCode(1); // for i
                let key=arr[i];
                let j=i - 1;

                viz.highlightCode(2); // int key = arr[i]

                viz.log(`å°† $ {
                        key
                    }

                    å–å‡ºä½œä¸ºå¾…æ’å…¥å…ƒç´ `);

                viz.renderBars(arr, [i], Array.from({
                        length: i
                    }

                    , (_, k)=> k)); // i is active
            await viz.wait();

            viz.highlightCode(6); // while

            while (j >=0 && arr[j] > key) {
                if ( !viz.isRunning) return;

                viz.highlightCode(7); // arr[j+1] = arr[j]

                viz.log(`$ {
                        arr[j]
                    }

                    > $ {
                        key
                    }

                    ï¼Œå‘åç§»åŠ¨`);
                arr[j+1]=arr[j];

                viz.renderBars(arr, [j, j + 1], Array.from({
                        length: i
                    }

                    , (_, k)=> k));
            await viz.wait();

            j=j - 1;
            viz.highlightCode(8); // j = j - 1
        }

        viz.highlightCode(11); // arr[j+1] = key
        arr[j+1]=key;

        viz.log(`å°† $ {
                key
            }

            æ’å…¥åˆ°ä½ç½® $ {
                j + 1
            }

            `);

        viz.renderBars(arr, [j + 1], Array.from({
                length: i + 1
            }

            , (_, k)=> k));
        await viz.wait();
        }

        viz.renderBars(arr, [], arr.map((_, i)=> i));
        viz.log("âœ… æ’åºå®Œæˆ");
        }

        ,

        async runLinearSearch() {
            let arr=viz.data;
            let target=viz.target;

            viz.highlightCode(0);
            await viz.wait();

            for (let i=0; i < arr.length; i++) {
                viz.highlightCode(2); // for i
                if ( !viz.isRunning) return;

                viz.highlightCode(4); // if (arr[i] == x)

                viz.log(`æ£€æŸ¥ç´¢å¼• $ {
                        i
                    }

                    : $ {
                        arr[i]
                    }

                    æ˜¯å¦ç­‰äº $ {
                        target
                    }

                    ?`);
                viz.renderBoxes(arr, i);
                await viz.wait();

                if (arr[i]===target) {
                    viz.highlightCode(5); // return i

                    viz.log(`âœ… æ‰¾åˆ°ç›®æ ‡ $ {
                            target
                        }

                        åœ¨ç´¢å¼• $ {
                            i
                        }

                        `);
                    viz.renderBoxes(arr, -1, i);
                    return;
                }
            }

            viz.highlightCode(8); // return -1

            viz.log(`âŒ æœªæ‰¾åˆ°ç›®æ ‡ $ {
                    target
                }

                `);
        }

        ,

        async runBinarySearch() {
            let arr=viz.data;
            let target=viz.target;
            let l=0,
            r=arr.length - 1;

            viz.highlightCode(0);
            await viz.wait();

            while (l <=r) {
                viz.highlightCode(1); // while
                if ( !viz.isRunning) return;

                let m=Math.floor((l + r) / 2);
                viz.highlightCode(3); // int m = ...

                viz.log(`æ£€æŸ¥ä¸­é—´å…ƒç´ ç´¢å¼• $ {
                        m
                    }

                    : $ {
                        arr[m]
                    }

                    `);

                // Highlight range and mid
                viz.renderBoxes(arr, m, -1, {
                    start: l, end: r
                });
            await viz.wait();

            viz.highlightCode(6); // if (arr[m] == x)

            if (arr[m]===target) {
                viz.highlightCode(7); // return m

                viz.log(`âœ… æ‰¾åˆ°ç›®æ ‡ $ {
                        target
                    }

                    åœ¨ç´¢å¼• $ {
                        m
                    }

                    `);
                viz.renderBoxes(arr, -1, m);
                return;
            }

            viz.highlightCode(10); // if (arr[m] < x)

            if (arr[m] < target) {
                viz.highlightCode(11); // l = m + 1
                l=m+1;

                viz.log(`ç›®æ ‡å¤§äº $ {
                        arr[m]
                    }

                    ï¼Œæœç´¢å³åŠéƒ¨åˆ†`);
            }

            else {
                viz.highlightCode(14); // else
                viz.highlightCode(15); // r = m - 1
                r=m - 1;

                viz.log(`ç›®æ ‡å°äº $ {
                        arr[m]
                    }

                    ï¼Œæœç´¢å·¦åŠéƒ¨åˆ†`);
            }
        }

        viz.highlightCode(17); // return -1

        viz.log(`âŒ æœªæ‰¾åˆ°ç›®æ ‡ $ {
                target
            }

            `);
        }
        }

        ;

        // Initialize
        document.addEventListener('DOMContentLoaded', ()=> {
                app.init();
            });
        </script></body></html>