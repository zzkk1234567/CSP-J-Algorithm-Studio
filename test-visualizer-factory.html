<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisualizerFactory æµ‹è¯•</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
    <style>
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .test-pass {
            background-color: #d1fae5;
            border-left: 4px solid #10b981;
        }
        .test-fail {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }
        .test-info {
            background-color: #dbeafe;
            border-left: 4px solid #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸ§ª VisualizerFactory åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">æµ‹è¯•ç»“æœ</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold mb-4">å¯è§†åŒ–æ¼”ç¤º</h2>
            <div id="demo-container"></div>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="algorithm-visualizer.js"></script>
    <script src="utils/VisualizerFactory.js"></script>
    
    <script>
        const testResults = document.getElementById('test-results');
        let testCount = 0;
        let passCount = 0;
        let failCount = 0;

        function logTest(name, passed, message = '') {
            testCount++;
            const div = document.createElement('div');
            div.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            
            const icon = passed ? 'âœ…' : 'âŒ';
            const status = passed ? 'PASS' : 'FAIL';
            
            div.innerHTML = `
                <strong>${icon} Test ${testCount}: ${name}</strong> - ${status}
                ${message ? `<br><span class="text-sm text-gray-600">${message}</span>` : ''}
            `;
            
            testResults.appendChild(div);
            
            if (passed) passCount++;
            else failCount++;
        }

        function logInfo(message) {
            const div = document.createElement('div');
            div.className = 'test-result test-info';
            div.innerHTML = `<strong>â„¹ï¸ ${message}</strong>`;
            testResults.appendChild(div);
        }

        function runTests() {
            logInfo('å¼€å§‹æµ‹è¯• VisualizerFactory...');
            
            // Test 1: å·¥å‚ç±»å­˜åœ¨
            logTest(
                'å·¥å‚ç±»å­˜åœ¨æ€§æ£€æŸ¥',
                typeof VisualizerFactory !== 'undefined',
                'VisualizerFactory ç±»å·²æ­£ç¡®åŠ è½½'
            );
            
            // Test 2: æ³¨å†Œæ–¹æ³•å­˜åœ¨
            logTest(
                'æ³¨å†Œæ–¹æ³•å­˜åœ¨æ€§æ£€æŸ¥',
                typeof VisualizerFactory.register === 'function',
                'register() æ–¹æ³•å¯ç”¨'
            );
            
            // Test 3: åˆ›å»ºæ–¹æ³•å­˜åœ¨
            logTest(
                'åˆ›å»ºæ–¹æ³•å­˜åœ¨æ€§æ£€æŸ¥',
                typeof VisualizerFactory.create === 'function',
                'create() æ–¹æ³•å¯ç”¨'
            );
            
            // Test 4: è·å–ç±»å‹æ–¹æ³•å­˜åœ¨
            logTest(
                'è·å–ç±»å‹æ–¹æ³•å­˜åœ¨æ€§æ£€æŸ¥',
                typeof VisualizerFactory.getAvailableTypes === 'function',
                'getAvailableTypes() æ–¹æ³•å¯ç”¨'
            );
            
            // Test 5: æ³¨å†Œå•ä¸ªå¯è§†åŒ–å™¨
            try {
                VisualizerFactory.register('test-bubble', SortingVisualizer);
                const types = VisualizerFactory.getAvailableTypes();
                logTest(
                    'æ³¨å†Œå•ä¸ªå¯è§†åŒ–å™¨',
                    types.includes('test-bubble'),
                    `å·²æ³¨å†Œç±»å‹: ${types.join(', ')}`
                );
            } catch (error) {
                logTest('æ³¨å†Œå•ä¸ªå¯è§†åŒ–å™¨', false, error.message);
            }
            
            // Test 6: æ‰¹é‡æ³¨å†Œå¯è§†åŒ–å™¨
            try {
                VisualizerFactory.registerBatch({
                    'bubble': SortingVisualizer,
                    'selection': SortingVisualizer,
                    'linear': SearchVisualizer,
                    'binary': SearchVisualizer,
                    'dfs': GraphVisualizer,
                    'bfs': GraphVisualizer
                });
                const count = VisualizerFactory.getRegisteredCount();
                logTest(
                    'æ‰¹é‡æ³¨å†Œå¯è§†åŒ–å™¨',
                    count >= 6,
                    `å·²æ³¨å†Œ ${count} ä¸ªå¯è§†åŒ–å™¨ç±»å‹`
                );
            } catch (error) {
                logTest('æ‰¹é‡æ³¨å†Œå¯è§†åŒ–å™¨', false, error.message);
            }
            
            // Test 7: æ£€æŸ¥ç±»å‹æ˜¯å¦å·²æ³¨å†Œ
            logTest(
                'æ£€æŸ¥ç±»å‹æ³¨å†ŒçŠ¶æ€',
                VisualizerFactory.isRegistered('bubble'),
                'bubble ç±»å‹å·²æ³¨å†Œ'
            );
            
            // Test 8: æ£€æŸ¥æœªæ³¨å†Œçš„ç±»å‹
            logTest(
                'æ£€æŸ¥æœªæ³¨å†Œç±»å‹',
                !VisualizerFactory.isRegistered('nonexistent'),
                'nonexistent ç±»å‹æœªæ³¨å†Œï¼ˆç¬¦åˆé¢„æœŸï¼‰'
            );
            
            // Test 9: åˆ›å»ºæ’åºå¯è§†åŒ–å™¨å®ä¾‹
            try {
                const sortViz = VisualizerFactory.create('bubble', 'demo-container', {
                    algorithm: 'bubble',
                    speed: 500
                });
                logTest(
                    'åˆ›å»ºæ’åºå¯è§†åŒ–å™¨å®ä¾‹',
                    sortViz instanceof SortingVisualizer,
                    'æˆåŠŸåˆ›å»º BubbleSort å¯è§†åŒ–å™¨å®ä¾‹'
                );
                
                // æ¸…ç†
                if (sortViz && typeof sortViz.destroy === 'function') {
                    sortViz.destroy();
                }
            } catch (error) {
                logTest('åˆ›å»ºæ’åºå¯è§†åŒ–å™¨å®ä¾‹', false, error.message);
            }
            
            // Test 10: åˆ›å»ºæœç´¢å¯è§†åŒ–å™¨å®ä¾‹
            try {
                const searchViz = VisualizerFactory.create('linear', 'demo-container', {
                    algorithm: 'linear'
                });
                logTest(
                    'åˆ›å»ºæœç´¢å¯è§†åŒ–å™¨å®ä¾‹',
                    searchViz instanceof SearchVisualizer,
                    'æˆåŠŸåˆ›å»º LinearSearch å¯è§†åŒ–å™¨å®ä¾‹'
                );
                
                // æ¸…ç†
                if (searchViz && typeof searchViz.destroy === 'function') {
                    searchViz.destroy();
                }
            } catch (error) {
                logTest('åˆ›å»ºæœç´¢å¯è§†åŒ–å™¨å®ä¾‹', false, error.message);
            }
            
            // Test 11: åˆ›å»ºå›¾å¯è§†åŒ–å™¨å®ä¾‹
            try {
                const graphViz = VisualizerFactory.create('dfs', 'demo-container', {
                    algorithm: 'dfs'
                });
                logTest(
                    'åˆ›å»ºå›¾å¯è§†åŒ–å™¨å®ä¾‹',
                    graphViz instanceof GraphVisualizer,
                    'æˆåŠŸåˆ›å»º DFS å¯è§†åŒ–å™¨å®ä¾‹'
                );
                
                // æ¸…ç†
                if (graphViz && typeof graphViz.destroy === 'function') {
                    graphViz.destroy();
                }
            } catch (error) {
                logTest('åˆ›å»ºå›¾å¯è§†åŒ–å™¨å®ä¾‹', false, error.message);
            }
            
            // Test 12: å°è¯•åˆ›å»ºæœªæ³¨å†Œçš„ç±»å‹ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
            try {
                VisualizerFactory.create('nonexistent', 'demo-container');
                logTest('é”™è¯¯å¤„ç† - æœªæ³¨å†Œç±»å‹', false, 'åº”è¯¥æŠ›å‡ºé”™è¯¯ä½†æ²¡æœ‰');
            } catch (error) {
                logTest(
                    'é”™è¯¯å¤„ç† - æœªæ³¨å†Œç±»å‹',
                    error.message.includes('Unknown visualizer type'),
                    'æ­£ç¡®æŠ›å‡ºé”™è¯¯: ' + error.message
                );
            }
            
            // Test 13: æ— æ•ˆå‚æ•°å¤„ç†
            try {
                VisualizerFactory.create('', 'demo-container');
                logTest('é”™è¯¯å¤„ç† - ç©ºç±»å‹', false, 'åº”è¯¥æŠ›å‡ºé”™è¯¯ä½†æ²¡æœ‰');
            } catch (error) {
                logTest(
                    'é”™è¯¯å¤„ç† - ç©ºç±»å‹',
                    error.message.includes('must be a non-empty string'),
                    'æ­£ç¡®æŠ›å‡ºé”™è¯¯: ' + error.message
                );
            }
            
            // Test 14: è·å–æ‰€æœ‰å¯ç”¨ç±»å‹
            const availableTypes = VisualizerFactory.getAvailableTypes();
            logTest(
                'è·å–æ‰€æœ‰å¯ç”¨ç±»å‹',
                Array.isArray(availableTypes) && availableTypes.length > 0,
                `å¯ç”¨ç±»å‹: ${availableTypes.join(', ')}`
            );
            
            // Test 15: å–æ¶ˆæ³¨å†Œ
            try {
                const unregistered = VisualizerFactory.unregister('test-bubble');
                logTest(
                    'å–æ¶ˆæ³¨å†Œå¯è§†åŒ–å™¨',
                    unregistered && !VisualizerFactory.isRegistered('test-bubble'),
                    'test-bubble å·²æˆåŠŸå–æ¶ˆæ³¨å†Œ'
                );
            } catch (error) {
                logTest('å–æ¶ˆæ³¨å†Œå¯è§†åŒ–å™¨', false, error.message);
            }
            
            // æ˜¾ç¤ºæµ‹è¯•æ€»ç»“
            logInfo(`æµ‹è¯•å®Œæˆ: æ€»è®¡ ${testCount} ä¸ªæµ‹è¯•ï¼Œé€šè¿‡ ${passCount} ä¸ªï¼Œå¤±è´¥ ${failCount} ä¸ª`);
            
            // åˆ›å»ºä¸€ä¸ªå®é™…çš„å¯è§†åŒ–æ¼”ç¤º
            createDemo();
        }

        function createDemo() {
            const demoContainer = document.getElementById('demo-container');
            demoContainer.innerHTML = `
                <h3 class="text-lg font-bold mb-4">ğŸ¯ å®é™…æ¼”ç¤ºï¼šä½¿ç”¨å·¥å‚åˆ›å»ºå†’æ³¡æ’åºå¯è§†åŒ–</h3>
                <div id="viz-demo"></div>
            `;
            
            try {
                // ä½¿ç”¨å·¥å‚åˆ›å»ºå¯è§†åŒ–å™¨
                const visualizer = VisualizerFactory.create('bubble', 'viz-demo', {
                    algorithm: 'bubble',
                    speed: 800
                });
                
                visualizer.setData([64, 34, 25, 12, 22, 11, 90]);
                visualizer.init();
                visualizer.initVisualization();
                
                // ç»‘å®šåˆ°å…¨å±€ä»¥ä¾¿æ§åˆ¶
                window.demoVisualizer = visualizer;
                
                demoContainer.innerHTML += `
                    <div class="mt-4 text-center">
                        <p class="text-green-600 font-bold">âœ… å¯è§†åŒ–å™¨åˆ›å»ºæˆåŠŸï¼</p>
                        <p class="text-sm text-gray-600 mt-2">ä½¿ç”¨æ§åˆ¶é¢æ¿ä¸­çš„æŒ‰é’®æ¥æ§åˆ¶åŠ¨ç”»</p>
                    </div>
                `;
            } catch (error) {
                demoContainer.innerHTML += `
                    <div class="mt-4 text-center">
                        <p class="text-red-600 font-bold">âŒ åˆ›å»ºå¤±è´¥: ${error.message}</p>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            runTests();
        });
    </script>
</body>
</html>
